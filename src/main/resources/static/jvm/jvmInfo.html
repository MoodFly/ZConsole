<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!--  <meta http-equiv="refresh" content="60" /> -->
<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="../static/bootstrap/css/bootstrap.min.css" />
<style type="text/css">
table{table-layout: fixed;}
td{word-break: break-all; word-wrap:break-word;}
</style>
</head>
<body>
	<div class="container">
		<div class="row">
			<div>
  			<!-- Nav tabs -->
  			<ul class="nav nav-tabs" role="tablist">
    			<li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">jvm信息</a></li>
    			<li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">系統信息</a></li>
  			</ul>
 	 		<!-- Tab panes -->
  			<div class="tab-content">
    			<div role="tabpanel" class="tab-pane active" id="home">
    				<table id="runtime" class="table table-striped  table-hover">
						<tr><td style="width:100px;">名称</td><td>值</td></tr>
					</table>
    			</div>
    			<div role="tabpanel" class="tab-pane" id="profile">
    				<table id="operatingSystem" class="table table-striped  table-hover">
						<tr><td style="width:130px;">名称</td><td>值</td></tr>
					</table>
    			</div>
  			</div>
			</div>
		</div>
	</div>
<script src="../static/js/jquery-3.2.1.js"></script>
<script src="../static/js/util.js" type="text/javascript"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="../static/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript">
var jvmId = gerUrlParam("id");
var runtime = $("#runtime");
var operatingSystem = $("#operatingSystem");
function showOperatingSystem(){
	$.post("/jmx/operatingSystem.json?jvmId="+jvmId, {}, function(result) {
		console.log(result);
		operatingSystem.append($("<tr>")
				.append($("<td>").append("操作系统"))
				.append($("<td>").append(result.name+" "+result.version)));
		operatingSystem.append($("<tr>")
				.append($("<td>").append("cpu核数"))
				.append($("<td>").append(result.availableProcessors)));
		if(result.systemLoadAverage > 0){
			operatingSystem.append($("<tr>")
				.append($("<td>").append("load"))
				.append($("<td>").append(result.systemLoadAverage)));
		}
		operatingSystem.append($("<tr>")
				.append($("<td>").append("物理内存"))
				.append($("<td>").append(bytesToSize(result.totalPhysicalMemorySize))));
		operatingSystem.append($("<tr>")
				.append($("<td>").append("空闲内存"))
				.append($("<td>").append(bytesToSize(result.freePhysicalMemorySize))));
		operatingSystem.append($("<tr>")
				.append($("<td>").append("物理交换区"))
				.append($("<td>").append(bytesToSize(result.totalSwapSpaceSize))));
		operatingSystem.append($("<tr>")
				.append($("<td>").append("空闲交换区"))
				.append($("<td>").append(bytesToSize(result.freeSwapSpaceSize))));
		if(result.maxFileDescriptorCount > 0){
			operatingSystem.append($("<tr>")
					.append($("<td>").append("最大文件描述符"))
					.append($("<td>").append(result.maxFileDescriptorCount)));
			operatingSystem.append($("<tr>")
					.append($("<td>").append("已打开文件描述符"))
					.append($("<td>").append(result.openFileDescriptorCount)));
		}
		
		

	});
}

function showRuntime(){
	$.post("/jmx/runtime.json?jvmId="+jvmId, {}, function(result) {
		runtime.append($("<tr>")
				.append($("<td>").append("pid"))
				.append($("<td>").append(result.pid)));
		runtime.append($("<tr>")
			    .append($("<td>").append("主机名"))
			    .append($("<td>").append(result.hostName)));
		runtime.append($("<tr>")
				.append($("<td>").append("启动用户"))
				.append($("<td>").append(result.systemProperties["user.name"])));
		runtime.append($("<tr>")
				.append($("<td>").append("时区"))
				.append($("<td>").append(result.systemProperties["user.timezone"])));
		runtime.append($("<tr>")
				.append($("<td>").append("语言"))
				.append($("<td>").append(result.systemProperties["user.language"]+"_"+result.systemProperties["user.country"])));
		runtime.append($("<tr>")
			    .append($("<td>").append("jvm版本"))
			    .append($("<td>").append(result.vmName+" "+result.specVersion+" "+result.vmVersion
				)));
		runtime.append($("<tr>")
			    .append($("<td>").append("启动时间"))
			    .append($("<td>").append(new Date(result.startTime).format("yyyy-MM-dd hh:mm:ss")
				)));
		runtime.append($("<tr>")
			    .append($("<td>").append("运行时间"))
			    .append($("<td>").append(formatDuring(result.uptime)
				)));
		runtime.append($("<tr>")
			    .append($("<td>").append("启动参数"))
			    .append($("<td>").append((function() {
			    	var container =$("<span>");
			    	var source =  result.inputArguments;
					for(var i in source){
						container.append($("<div>").append(source[i]));
					}
					return container;
					})()
				)));
		runtime.append($("<tr>")
			    .append($("<td>").append("classpath"))
			    .append($("<td>").append(result.classPath
				)));
		runtime.append($("<tr>")
			    .append($("<td>").append("jvm类路径"))
			    .append($("<td>").append(result.bootClassPath
				)));
		runtime.append($("<tr>")
			    .append($("<td>").append("系统路径"))
			    .append($("<td>").append(result.libraryPath
				)));
		runtime.append($("<tr>")
			    .append($("<td>").append("系统参数"))
			    .append($("<td>").append((function() {
			    	var container =$("<span>");
			    	var source =  result.systemProperties;
					for(var i in source){
						container.append($("<div>").append(i+"="+source[i]));
					}
					return container;
					})()
				)));
	});
}

showRuntime();
showOperatingSystem();
</script>
</body>
</html>